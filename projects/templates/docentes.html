<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Campus Facultad - Pasantías, Tesis e Investigaciones</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- DataTables CSS -->
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/home.css">
</head>
<body>


      <!-- Encabezado -->
  <header>
    <h1>Universidad del Cauca</h1>
    <p>Pasantías, Tesis e Investigaciones</p>

    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg" style="background-color: #0c4185;">
      <div class="container-fluid">
        <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>   

        <div class="collapse navbar-collapse" id="navbarMenu">
          <ul class="navbar-nav ms-auto">
            <!-- Menú desplegable -->
            <li class="nav-item dropdown">
              <a class="nav-link navbar-st dropdown-toggle text-white fw-semibold" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Opciones
              </a>
              <ul class="dropdown-menu dropdown-menu-end shadow">
                <li><a class="dropdown-item" href="#">Listado de Alumnos</a></li>
                <li><a class="dropdown-item" href="{% url 'docentes' %}">Listado de Profesores</a></li>
                <li><a class="dropdown-item" href="#">Usuarios</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Guía del Sistema</a></li>
                <li><a class="dropdown-item" href="{% url 'logout' %}">Cerrar Sesión</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

  </header>


      <!-- Contenido -->
  <div class="container-xl">
    <div class="card shadow-lg rounded-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="mb-0" style="color: #0c4185;">Listado de profesores</h2>
          <button class="btn d-flex align-items-center justify-content-center" 
                  style="background-color: #0c4185; color: #fff;"
                  data-bs-toggle="modal" data-bs-target="#addModal">
            Agregar
          </button>
        </div>
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show mt-3" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
        <div class="table-responsive">
          <table id="datatable" class="table table-bordered table-hover align-middle" style="width:100%">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Departamento</th>
                <th>Facultad</th>
                <th>Email</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
            {% for docente in docentes %}
              <tr>
                <td>{{ docente.nombre }}</td>
                <td>{{ docente.departamento }}</td>
                <td>{{docente.facultad}}</td>
                <td>{{docente.email}}</td>
                <td>
                <div class="btn-group">
                  <button class="btn btn-modificar btn-sm"
                          style="background-color: #0c4185; color: #fff;"
                          data-bs-toggle="modal"
                          data-id="{{ docente.id }}"
                          data-nombre="{{ docente.nombre }}"
                          data-departamento="{{ docente.departamento }}"
                          data-facultad="{{ docente.facultad }}"
                          data-email="{{ docente.email }}"
                          data-bs-target="#editModal">
                    MODIFICAR
                  </button>
                  <button class="btn btn-eliminar btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal" data-id="{{ docente.id }}">ELIMINAR</button>
                </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


  <!-- Modal para Agregar Registro -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius: 15px;">
      
      <!-- Encabezado -->
      <div class="modal-header" style="background-color: #a81f17; color: #fff;">
        <h5 class="modal-title" id="addModalLabel">Agregar Nuevo Registro</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      
      <!-- Cuerpo -->
      <div class="modal-body">
        <form method="post" action="{% url 'agregar_docente' %}">
            {% csrf_token %}
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Nombre</label>
              <input name="nombre" type="text" class="form-control" placeholder="Nombre completo">
            </div>
            <div class="col-md-4">
              <label class="form-label">Departamento</label>
              <input name="departamento" type="text" class="form-control" placeholder="Departamento">
            </div>
            <div class="col-md-6">
              <label class="form-label">Facultad</label>
              <input name="facultad" type="text" class="form-control" placeholder="Facultad">
            </div>
            <div class="col-md-6">
              <label class="form-label">Email</label>
              <input name="email" type="email" class="form-control" placeholder="Email del profesor">
            </div>
          </div>
                <!-- Pie del modal -->
          <div class="modal-footer">
              <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #a81f17;       color: #ffffff;">
              Cancelar
              </button>
              <button type="submit" class="btn" style="background-color: #0c4185; color: #fff;">
              Guardar
              </button>
          </div>
        </form>
      </div>
      
    </div>
  </div>
</div>


<!-- Modal Eliminar -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 15px;">

      <!-- Encabezado -->
      <div class="modal-header" style="background-color: #a81f17; color: #fff;">
        <h5 class="modal-title" id="deleteModalLabel">Confirmar Eliminación</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <!-- Cuerpo -->
      <div class="modal-body" style="color: #4b161f; font-size: 16px;">
        ¿Estás seguro que deseas eliminar este registro?
        <br><small class="text-muted">Esta acción no se puede deshacer.</small>
      </div>

      <!-- Pie del modal -->
      <div class="modal-footer">
        <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #0c4185; color: #ffffff;">
          Cancelar
        </button>

        <form id="deleteForm" method="post" action="">
          {% csrf_token %}
          <button type="submit" class="btn" style="background-color: #a81f17; color: #fff;">
            Confirmar
          </button>
        </form>
      </div>

    </div>
  </div>
</div>


<!-- Modal de Modificación -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius: 15px;">
      
      <div class="modal-header" style="background-color: #0c4185; color: #fff;">
        <h5 class="modal-title" id="editModalLabel">Modificar Registro</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      
      <div class="modal-body">
        <form id="editForm" method="post" action="">
          {% csrf_token %}
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Nombre</label>
              <input id="editNombre" type="text" class="form-control" name="nombre" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Departamento</label>
              <input id="editDepartamento" type="text" class="form-control" name="departamento" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Facultad</label>
              <input id="editFacultad" type="text" class="form-control" name="facultad" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Email</label>
              <input id="editEmail" type="email" class="form-control" name="email" required>
            </div>
          </div>

          <div class="modal-footer mt-4">
            <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #a81f17; color: #ffffff;">
              Cancelar
            </button>
            <button type="submit" class="btn" style="background-color: #0c4185; color: #fff;">
              Guardar cambios
            </button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>


    
  <!-- Bootstrap & DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="../static/js/home.js"></script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
      const deleteModal = document.getElementById('deleteModal');
      const deleteForm = document.getElementById('deleteForm');

      deleteModal.addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget; // botón que abrió el modal
    const docenteId = button.getAttribute('data-id'); // obtenemos el id
    deleteForm.action = `/eliminar_docente/${docenteId}/`; // actualizamos el action dinámicamente
  });
    });



  document.addEventListener('DOMContentLoaded', function() {
    const editModal = document.getElementById('editModal');
    const editForm = document.getElementById('editForm'); 

    editModal.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      const docenteId = button.getAttribute('data-id'); 

      // Llenar los campos del formulario con los datos actuales
      document.getElementById('editNombre').value = button.getAttribute('data-nombre');
      document.getElementById('editDepartamento').value = button.getAttribute('data-departamento');
      document.getElementById('editFacultad').value = button.getAttribute('data-facultad');
      document.getElementById('editEmail').value = button.getAttribute('data-email'); 

      // Actualizar la acción del formulario dinámicamente
      editForm.action = `/modificar_docente/${docenteId}/`;
    });
});
</script>

</script>

</body>
</html>