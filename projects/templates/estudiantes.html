<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Campus Facultad - Pasantías, Tesis e Investigaciones</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- DataTables CSS -->
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/home.css">
</head>
<body>


      <!-- Encabezado -->
  <header>
    <h1>Universidad del Cauca</h1>
    <p>Pasantías, Tesis e Investigaciones</p>

    <!-- Barra de navegación -->
    <nav class="navbar navbar-expand-lg" style="background-color: #0c4185;">
      <div class="container-fluid">
        <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>   

        <div class="collapse navbar-collapse" id="navbarMenu">
          <ul class="navbar-nav ms-auto">
            <!-- Menú desplegable -->
            <li class="nav-item dropdown">
              <a class="nav-link navbar-st dropdown-toggle text-white fw-semibold" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                Opciones
              </a>
              <ul class="dropdown-menu dropdown-menu-end shadow">
                <li><a class="dropdown-item" href="{% url 'estudiantes' %}">Listado de estudiantes</a></li>
                <li><a class="dropdown-item" href="{% url 'docentes' %}">Listado de Profesores</a></li>
                <li><a class="dropdown-item" href="#">Usuarios</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Guía del Sistema</a></li>
                <li><a class="dropdown-item" href="{% url 'logout' %}">Cerrar Sesión</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

  </header>


      <!-- Contenido -->
  <div class="container-xl">
    <div class="card shadow-lg rounded-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="mb-0" style="color: #0c4185;">Listado de estudiantes</h2>
          <button class="btn d-flex align-items-center justify-content-center" 
                  style="background-color: #0c4185; color: #fff;"
                  data-bs-toggle="modal" data-bs-target="#addModal">
            Agregar
          </button>
        </div>
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show mt-3" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
        <div class="table-responsive">
          <table id="datatable" class="table table-bordered table-hover align-middle" style="width:100%">
            <thead>
              <tr>
                <th>Legajo</th>
                <th>Primer apellido</th>   
                <th>Segundo apellido</th>  
                <th>Primer nombre</th> 
                <th>Segundo nombre</th>
                <th>Facultad</th>  
                <th>Programa</th>  
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
            {% for estudiante in estudiantes %}
              <tr>
                <td>{{ estudiante.legajo }}</td>
                <td>{{ estudiante.primer_apellido }}</td>
                <td>{{ estudiante.segundo_apellido }}</td>
                <td>{{ estudiante.primer_nombre }}</td>
                <td>{{ estudiante.segundo_nombre }}</td>
                <td>{{ estudiante.facultad }}</td>
                <td>{{ estudiante.programa }}</td>
                <td>
                <div class="btn-group">
                  <button class="btn btn-modificar btn-sm"
                    style="background-color: #0c4185; color: #fff;"
                    data-bs-toggle="modal"
                    data-id="{{ estudiante.legajo }}"
                    data-tipo-identificacion="{{ estudiante.tipo_identificacion }}"
                    data-identificacion="{{ estudiante.identificacion }}"
                    data-primer-apellido="{{ estudiante.primer_apellido }}"
                    data-segundo-apellido="{{ estudiante.segundo_apellido }}"
                    data-primer-nombre="{{ estudiante.primer_nombre }}"
                    data-segundo-nombre="{{ estudiante.segundo_nombre }}"
                    data-correo-institucional="{{ estudiante.correo_institucional }}"
                    data-telefono="{{ estudiante.telefono }}"
                    data-celular="{{ estudiante.celular }}"
                    data-estudiante="{{ estudiante.estudiante }}"
                    data-facultad="{{ estudiante.facultad }}"
                    data-programa="{{ estudiante.programa }}"
                    data-regionalizacion="{{ estudiante.regionalizacion }}"
                    data-sede="{{ estudiante.sede }}"
                    data-jornada="{{ estudiante.jornada }}"
                    data-periodo="{{ estudiante.periodo }}"
                    data-bs-target="#editModal">
                    MODIFICAR
                  </button>
                  <button class="btn btn-eliminar btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal" data-id="{{ estudiante.legajo }}">ELIMINAR</button>
                  <button type="button" 
                          class="btn btn-sm btn-detalle" style="background-color: #989f0e; color: #fff;"
                          data-id="{{ estudiante.legajo }}"
                          data-tipo-identificacion="{{ estudiante.tipo_identificacion }}"
                          data-identificacion="{{ estudiante.identificacion }}"
                          data-primer-apellido="{{ estudiante.primer_apellido }}"
                          data-segundo-apellido="{{ estudiante.segundo_apellido }}"
                          data-primer-nombre="{{ estudiante.primer_nombre }}"
                          data-segundo-nombre="{{ estudiante.segundo_nombre }}"
                          data-correo-institucional="{{ estudiante.correo_institucional }}"
                          data-telefono="{{ estudiante.telefono }}"
                          data-celular="{{ estudiante.celular }}"
                          data-estudiante="{{ estudiante.estudiante }}"
                          data-facultad="{{ estudiante.facultad }}"
                          data-programa="{{ estudiante.programa }}"
                          data-regionalizacion="{{ estudiante.regionalizacion }}"
                          data-sede="{{ estudiante.sede }}"
                          data-jornada="{{ estudiante.jornada }}"
                          data-periodo="{{ estudiante.periodo }}">
                    DETALLE
                  </button>
                </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


  <!-- Modal para Agregar Registro -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius: 15px;">
      
      <!-- Encabezado -->
      <div class="modal-header" style="background-color: #a81f17; color: #fff;">
        <h5 class="modal-title" id="addModalLabel">Agregar Nuevo Registro</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      
      <!-- Cuerpo -->
      <div class="modal-body">
        <form method="post" action="{% url 'agregar_estudiante' %}">
            {% csrf_token %}
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Legajo</label>
              <input name="legajo" type="text" class="form-control" placeholder="Legajo del estudiante" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Tipo identificacion</label>
              <input name="tipo_identificacion" type="text" class="form-control" placeholder="Tipo de identificación" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Identificacion</label>
              <input name="identificacion" type="text" class="form-control" placeholder="Número de identificación" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">Primer apellido</label>
                <input name="primer_apellido" type="text" class="form-control" placeholder="Primer apellido" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo apellido</label>
                <input name="segundo_apellido" type="text" class="form-control" placeholder="Segundo apellido" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Primer nombre</label>
                <input name="primer_nombre" type="text" class="form-control" placeholder="Primer nombre" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo nombre</label>
                <input name="segundo_nombre" type="text" class="form-control" placeholder="Segundo nombre" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Correo institucional</label>
                <input name="correo_institucional" type="email" class="form-control" placeholder="Correo institucional" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Teléfono</label>
                <input name="telefono" type="text" class="form-control" placeholder="Número de teléfono" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Celular</label>
                <input name="celular" type="text" class="form-control" placeholder="Número de celular" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Estudiante</label>
                <input name="estudiante" type="text" class="form-control" placeholder="Nombre del estudiante" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Facultad</label>
                <input name="facultad" type="text" class="form-control" placeholder="Facultad" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Programa</label>
                <input name="programa" type="text" class="form-control" placeholder="Programa" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Regionalización</label>
                <input name="regionalizacion" type="text" class="form-control" placeholder="Regionalización" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Sede</label>
                <input name="sede" type="text" class="form-control" placeholder="Sede" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Jornada</label>
                <input name="jornada" type="text" class="form-control" placeholder="Jornada" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Período</label>
                <input name="periodo" type="text" class="form-control" placeholder="Período" required>
              </div>
            </div>
                <!-- Pie del modal -->
          <div class="modal-footer" style="justify-content: center;">
              <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #a81f17;       color: #ffffff;">
              Cancelar
              </button>
              <button type="submit" class="btn" style="background-color: #0c4185; color: #fff;">
              Guardar
              </button>
          </div>
        </form>
      </div>
      
    </div>
  </div>
</div>


<!-- Modal Eliminar -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 15px;">

      <!-- Encabezado -->
      <div class="modal-header" style="background-color: #a81f17; color: #fff;">
        <h5 class="modal-title" id="deleteModalLabel">Confirmar Eliminación</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <!-- Cuerpo -->
      <div class="modal-body" style="color: #4b161f; font-size: 16px;">
        ¿Estás seguro que deseas eliminar este registro?
        <br><small class="text-muted">Esta acción no se puede deshacer.</small>
      </div>

      <!-- Pie del modal -->
      <div class="modal-footer">
        <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #0c4185; color: #ffffff;">
          Cancelar
        </button>

        <form id="deleteForm" method="post" action="">
          {% csrf_token %}
          <button type="submit" class="btn" style="background-color: #a81f17; color: #fff;">
            Confirmar
          </button>
        </form>
      </div>

    </div>
  </div>
</div>


<!-- Modal de Modificación -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius: 15px;">
      
      <div class="modal-header" style="background-color: #0c4185; color: #fff;">
        <h5 class="modal-title" id="editModalLabel">Modificar Registro</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      
      <div class="modal-body">
        <form id="editForm" method="post" action="">
          {% csrf_token %}
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Tipo identificacion</label>
              <input id="editTipo-identificacion" type="text" class="form-control" name="tipo_identificacion" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Identificacion</label>
              <input id="editIdentificacion" type="text" class="form-control" name="identificacion" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">Primer apellido</label>
                <input id="editPrimer-apellido" type="text" class="form-control" name="primer_apellido" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo apellido</label>
                <input id="editSegundo-apellido" type="text" class="form-control" name="segundo_apellido" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Primer nombre</label>
                <input id="editPrimer-nombre" type="text" class="form-control" name="primer_nombre" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo nombre</label>
                <input id="editSegundo-nombre" type="text" class="form-control" name="segundo_nombre" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Correo institucional</label>
                <input id="editCorreo-institucional" type="email" class="form-control" name="correo_institucional" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Teléfono</label>
                <input id="editTelefono" type="text" class="form-control" name="telefono" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Celular</label>
                <input id="editCelular" type="text" class="form-control" name="celular" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Estudiante</label>
                <input id="editEstudiante" type="text" class="form-control" name="estudiante" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Facultad</label>
                <input id="editFacultad" type="text" class="form-control" name="facultad" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Programa</label>
                <input id="editPrograma" type="text" class="form-control" name="programa" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Regionalización</label>
                <input id="editRegionalizacion" type="text" class="form-control" name="regionalizacion" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Sede</label>
                <input id="editSede" type="text" class="form-control" name="sede" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Jornada</label>
                <input id="editJornada" type="text" class="form-control" name="jornada" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Período</label>
                <input id="editPeriodo" type="text" class="form-control" name="periodo" required>
              </div>
          </div>

          <div class="modal-footer mt-4">
            <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #a81f17; color: #ffffff;">
              Cancelar
            </button>
            <button type="submit" class="btn" style="background-color: #0c4185; color: #fff;">
              Guardar cambios
            </button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<!-- Modal de Detalle de Estudiante -->
<div class="modal fade" id="detalleModal" tabindex="-1" aria-labelledby="detalleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header text-white" style="background: #a81f17;">
        <h5 class="modal-title" id="detalleModalLabel">Detalle del Estudiante</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-md-6"><strong>Legajo:</strong> <span id="detalleLegajo"></span></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-6"><strong>Tipo de identificación:</strong> <span id="detalleTipoIdentificacion"></span></div>
            <div class="col-md-6"><strong>Identificación:</strong> <span id="detalleIdentificacion"></span></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-6"><strong>Primer apellido:</strong> <span id="detallePrimerApellido"></span></div>
            <div class="col-md-6"><strong>Segundo apellido:</strong> <span id="detalleSegundoApellido"></span></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-6"><strong>Primer nombre:</strong> <span id="detallePrimerNombre"></span></div>
            <div class="col-md-6"><strong>Segundo nombre:</strong> <span id="detalleSegundoNombre"></span></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-6"><strong>Correo institucional:</strong> <span id="detalleCorreo"></span></div>
            <div class="col-md-6"><strong>Teléfono:</strong> <span id="detalleTelefono"></span></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-6"><strong>Celular:</strong> <span id="detalleCelular"></span></div>
            <div class="col-md-6"><strong>Estudiante:</strong> <span id="detalleEstudiante"></span></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-6"><strong>Facultad:</strong> <span id="detalleFacultad"></span></div>
            <div class="col-md-6"><strong>Programa:</strong> <span id="detallePrograma"></span></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-6"><strong>Regionalización:</strong> <span id="detalleRegionalizacion"></span></div>
            <div class="col-md-6"><strong>Sede:</strong> <span id="detalleSede"></span></div>
          </div>
          <div class="row mb-2">
            <div class="col-md-6"><strong>Jornada:</strong> <span id="detalleJornada"></span></div>
            <div class="col-md-6"><strong>Periodo:</strong> <span id="detallePeriodo"></span></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>


    
  <!-- Bootstrap & DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="../static/js/home.js"></script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
      const deleteModal = document.getElementById('deleteModal');
      const deleteForm = document.getElementById('deleteForm');

      deleteModal.addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget; // botón que abrió el modal
    const estudianteId = button.getAttribute('data-id'); // obtenemos el id
    deleteForm.action = `/eliminar_estudiante/${estudianteId}/`; // actualizamos el action dinámicamente
  });
    });



  document.addEventListener('DOMContentLoaded', function() {
    const editModal = document.getElementById('editModal');
    const editForm = document.getElementById('editForm'); 

    editModal.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      const estudianteId = button.getAttribute('data-id'); 

      // Llenar los campos del formulario con los datos actuales
      document.getElementById('editTipo-identificacion').value = button.getAttribute('data-tipo-identificacion');
      document.getElementById('editIdentificacion').value = button.getAttribute('data-identificacion');
      document.getElementById('editPrimer-apellido').value = button.getAttribute('data-primer-apellido');
      document.getElementById('editSegundo-apellido').value = button.getAttribute('data-segundo-apellido');
      document.getElementById('editPrimer-nombre').value = button.getAttribute('data-primer-nombre');
      document.getElementById('editSegundo-nombre').value = button.getAttribute('data-segundo-nombre');
      document.getElementById('editCorreo-institucional').value = button.getAttribute('data-correo-institucional');
      document.getElementById('editTelefono').value = button.getAttribute('data-telefono');
      document.getElementById('editCelular').value = button.getAttribute('data-celular');
      document.getElementById('editEstudiante').value = button.getAttribute('data-estudiante');
      document.getElementById('editFacultad').value = button.getAttribute('data-facultad');
      document.getElementById('editPrograma').value = button.getAttribute('data-programa');
      document.getElementById('editRegionalizacion').value = button.getAttribute('data-regionalizacion');
      document.getElementById('editSede').value = button.getAttribute('data-sede');
      document.getElementById('editJornada').value = button.getAttribute('data-jornada');
      document.getElementById('editPeriodo').value = button.getAttribute('data-periodo');
      // Actualizar la acción del formulario dinámicamente
      editForm.action = `/modificar_estudiante/${estudianteId}/`;
    });});

    document.addEventListener('DOMContentLoaded', function() {
      const detalleButtons = document.querySelectorAll('.btn-detalle');

      detalleButtons.forEach(button => {
        button.addEventListener('click', () => {
          document.getElementById('detalleLegajo').textContent = button.getAttribute('data-id');
          document.getElementById('detalleTipoIdentificacion').textContent = button.getAttribute    ('data-tipo-identificacion');
          document.getElementById('detalleIdentificacion').textContent = button.getAttribute    ('data-identificacion');
          document.getElementById('detallePrimerApellido').textContent = button.getAttribute    ('data-primer-apellido');
          document.getElementById('detalleSegundoApellido').textContent = button.getAttribute   ('data-segundo-apellido');
          document.getElementById('detallePrimerNombre').textContent = button.getAttribute  ('data-primer-nombre');
          document.getElementById('detalleSegundoNombre').textContent = button.getAttribute ('data-segundo-nombre');
          document.getElementById('detalleCorreo').textContent = button.getAttribute    ('data-correo-institucional');
          document.getElementById('detalleTelefono').textContent = button.getAttribute('data-telefono');
          document.getElementById('detalleCelular').textContent = button.getAttribute('data-celular');
          document.getElementById('detalleEstudiante').textContent = button.getAttribute('data-estudiante');
          document.getElementById('detalleFacultad').textContent = button.getAttribute('data-facultad');
          document.getElementById('detallePrograma').textContent = button.getAttribute('data-programa');
          document.getElementById('detalleRegionalizacion').textContent = button.getAttribute   ('data-regionalizacion');
          document.getElementById('detalleSede').textContent = button.getAttribute('data-sede');
          document.getElementById('detalleJornada').textContent = button.getAttribute('data-jornada');
          document.getElementById('detallePeriodo').textContent = button.getAttribute('data-periodo');

          // Mostrar el modal
          const modal = new bootstrap.Modal(document.getElementById('detalleModal'));
          modal.show();
        });
      });

});
</script>

</script>

</body>
</html>

